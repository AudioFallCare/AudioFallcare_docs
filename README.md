# AudioFallCare

소리 기반 낙상 감지 및 보호자 알림 시스템

## 시스템 개요

노약자/환자의 낙상 사고를 소리 데이터 분석을 통해 감지하고, 보호자에게 실시간 알림을 제공하는 서비스입니다.

## 팀 멤버

<table>
  <tr>
    <td align="center">
      <a href="https://github.com/chominseo0723">
        <img src="https://github.com/chominseo0723.png" width="100px;" alt="chominseo0723"/><br />
        <sub><b>chominseo0723</b></sub>
      </a>
    </td>
    <td align="center">
      <a href="https://github.com/FAITRUEE">
        <img src="https://github.com/FAITRUEE.png" width="100px;" alt="FAITRUEE"/><br />
        <sub><b>FAITRUEE</b></sub>
      </a>
    </td>
    <td align="center">
      <a href="https://github.com/LENA2610">
        <img src="https://github.com/LENA2610.png" width="100px;" alt="LENA2610"/><br />
        <sub><b>LENA2610</b></sub>
      </a>
    </td>
    <td align="center">
      <a href="https://github.com/ming920">
        <img src="https://github.com/ming920.png" width="100px;" alt="ming920"/><br />
        <sub><b>ming920</b></sub>
      </a>
    </td>
    <td align="center">
      <a href="https://github.com/ojm6135">
        <img src="https://github.com/ojm6135.png" width="100px;" alt="ojm6135"/><br />
        <sub><b>ojm6135</b></sub>
      </a>
    </td>
  </tr>
</table>

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────┐
│                        AudioFallCare System                         │
└─────────────────────────────────────────────────────────────────────┘

┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  1. 소리     │      │  2. 낙상     │      │  3. 결과     │
│  데이터 입력  │ ───▶ │  분류 (AI)   │ ───▶ │  저장        │
│  🎤 마이크   │      │              │      │  (공개 API)  │
│  (브라우저)  │      │              │      │              │
└──────────────┘      └──────────────┘      └──────────────┘
                                                   │
                                                   ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  6. 신고     │      │  5. 보호자   │      │  4. 알림     │
│  (보호 API)  │ ◀─── │  웹앱        │ ◀─── │  생성        │
│              │      │  (로그인 ⭕) │      │  (자동)      │
└──────────────┘      └──────────────┘      └──────────────┘
```

## 작동 방식

### 전체 흐름

```
[노약자 방]                     [서버]                     [보호자]
    │                            │                           │
    │  1. 기기 등록               │                           │
    │  ─────────────────────────▶│                           │
    │         device_id 발급      │                           │
    │                            │                           │
    │  2. 녹음 시작 (5초 단위)     │                           │
    │  ─────────────────────────▶│                           │
    │      POST /api/audio/upload │                           │
    │                            │                           │
    │                       3. AI 분류                        │
    │                       fall: true                        │
    │                       confidence: 0.87                  │
    │                            │                           │
    │                       4. 알림 생성 ───────────────────▶│ 🔔 푸시 알림
    │                            │                           │
    │                            │                           │  5. 웹앱 확인
    │                            │◀──────────────────────────│  GET /api/alerts
    │                            │                           │
    │                            │                           │  6. 신고 결정
    │                            │◀──────────────────────────│  POST /api/report
    │                            │                           │
```

### 녹음 클라이언트 (프론트엔드)

노약자/환자 방에 설치된 기기에서 실행되는 웹페이지입니다.

```
┌─────────────────────────────────────────────────────────────────┐
│  📱 녹음 클라이언트                                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [1] 기기 등록                                                   │
│      POST /api/devices/register → device_id 발급                │
│                                                                 │
│  [2] 마이크 권한 요청                                            │
│      navigator.mediaDevices.getUserMedia()                      │
│                                                                 │
│  [3] 녹음 시작                                                   │
│      MediaRecorder API로 오디오 캡처                             │
│                                                                 │
│  [4] 청크 전송 (5초마다 반복)                                     │
│      POST /api/audio/upload { device_id, audio_blob }           │
│      ↓                                                          │
│      응답: { fall: true/false, confidence, soundType }          │
│                                                                 │
│  [5] 낙상 감지 시 → 서버가 자동으로 보호자에게 알림               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 보호자 웹앱 (프론트엔드 + 로그인)

보호자가 알림을 확인하고 관리하는 웹페이지입니다.

```
┌─────────────────────────────────────────────────────────────────┐
│  👨‍👩‍👧 보호자 웹앱                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [1] 로그인 / 회원가입                                           │
│                                                                 │
│  [2] 대시보드                                                    │
│      ├─ 등록된 기기 목록 (GET /api/devices)                      │
│      ├─ 최근 알림 요약                                           │
│      └─ 낙상 통계 그래프                                         │
│                                                                 │
│  [3] 알림 목록 (GET /api/alerts)                                 │
│      ├─ 낙상 감지 알림                                           │
│      ├─ 시간, 신뢰도, 소리 유형                                   │
│      └─ 읽음 / 안읽음 처리                                       │
│                                                                 │
│  [4] 낙상 이력 (GET /api/history)                                │
│      ├─ 날짜별 이벤트 조회                                       │
│      └─ 상세 분석 결과                                           │
│                                                                 │
│  [5] 신고 (POST /api/report)                                    │
│      └─ 119 신고 또는 관리자 호출                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 주요 기능

### 1. 소리 데이터 입력 (브라우저 마이크)

웹 브라우저의 마이크 입력 기능을 활용하여 실시간으로 소리 데이터를 수집합니다.

| 항목 | 설명 |
|------|------|
| 입력 방식 | 브라우저 마이크 (Web Audio API / MediaRecorder API) |
| 데이터 형식 | PCM / WebM / WAV |
| 처리 방식 | 청크 단위 전송 (HTTP POST) |
| 실시간 | ⭕ |
| 인증 | 불필요 (기기 등록 필요) |

**브라우저 요구사항:**
- HTTPS 연결 필수 (마이크 권한)
- getUserMedia API 지원 브라우저
- Chrome, Firefox, Edge, Safari 지원

**녹음 클라이언트 동작:**
```
┌─────────────────────────────────────────────────────────┐
│                    녹음 클라이언트                        │
├─────────────────────────────────────────────────────────┤
│  🎤 마이크 → Web Audio API → 버퍼링 → 서버 전송         │
│                                                         │
│  [녹음 시작] [녹음 중지] [상태: 🔴 녹음중]               │
└─────────────────────────────────────────────────────────┘
```

### 2. 낙상 분류 (AI)

AI 모델이 소리 데이터를 분석하여 다음을 판단:

```json
{
  "fall": true,
  "confidence": 0.87,
  "soundType": "Impact"
}
```

| 출력 항목 | 설명 |
|-----------|------|
| `fall` | 낙상 여부 (boolean) |
| `confidence` | 신뢰도 (0.0 ~ 1.0) |
| `soundType` | 소리 유형 (Impact, Scream, Thud 등) |

### 3. 결과 저장 (공개 API)

- 분류 결과를 서버에 저장
- 이벤트 로그로 기록
- 인증 불필요

### 4. 알림 생성 (자동)

- 위험도 기준 초과 시 자동 생성
- 알림 테이블에 기록
- 로그인 불필요

### 5. 보호자 웹앱 (로그인 필요 ⭕)

보호자 전용 기능:

- 낙상 이력 조회
- 알림 확인 및 관리
- 상세 분석 결과 확인
- 대시보드

### 6. 신고 (보호 API)

- 보호자 판단 후 신고 기능
- 인증 필요 (보호 API)

## API 구조

| 구분 | 엔드포인트 | 인증 | 설명 |
|------|-----------|------|------|
| 공개 | `POST /api/audio/upload` | ❌ | 오디오 청크 업로드 |
| 공개 | `POST /api/devices/register` | ❌ | 기기 등록 |
| 공개 | `POST /api/classify` | ❌ | 낙상 분류 요청 |
| 공개 | `POST /api/events` | ❌ | 결과 저장 |
| 보호 | `GET /api/alerts` | ⭕ | 알림 목록 조회 |
| 보호 | `GET /api/history` | ⭕ | 낙상 이력 조회 |
| 보호 | `GET /api/devices` | ⭕ | 등록된 기기 목록 |
| 보호 | `POST /api/report` | ⭕ | 신고 요청 |

## 기술 스택

> 상세 스택은 추후 결정

**녹음 클라이언트 (필수):**
- Web Audio API - 마이크 입력 처리
- MediaRecorder API - 오디오 녹음

## 디렉토리 구조

```
AudioFallCare/
├── README.md
├── docs/                # 문서
│   └── SRS.md          # 소프트웨어 요구사항 명세서
├── ai/                  # AI 모델
│   ├── model/          # 학습된 모델
│   └── preprocessing/  # 데이터 전처리
├── server/             # 백엔드 서버
│   ├── api/            # API 엔드포인트
│   └── services/       # 비즈니스 로직
├── recorder/           # 녹음 클라이언트 (브라우저)
│   ├── src/
│   │   ├── audio/      # Web Audio API 래퍼
│   │   ├── stream/     # 서버 스트리밍 로직
│   │   └── ui/         # 녹음 UI 컴포넌트
│   └── public/
└── webapp/             # 보호자 웹앱
    ├── src/
    └── public/
```

## 라이선스

> TBD

---

*Last Updated: 2026-01-27*
