# AudioFallCare ì•„í‚¤í…ì²˜ ì„¤ê³„ì„œ

> ì†Œë¦¬ ê¸°ë°˜ ë‚™ìƒ ê°ì§€ ë° ë³´í˜¸ì ì•Œë¦¼ ì‹œìŠ¤í…œ

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 í”„ë¡œì íŠ¸ ëª©ì 
ë…¸ì•½ì ë° í™˜ìê°€ ìˆëŠ” ê³µê°„ì—ì„œ ë§ˆì´í¬ë¥¼ í†µí•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì†Œë¦¬ë¥¼ ìˆ˜ì§‘í•˜ê³ , AIê°€ ë‚™ìƒì„ ê°ì§€í•˜ë©´ ë³´í˜¸ìì—ê²Œ ì¦‰ì‹œ ì•Œë¦¼ì„ ì „ì†¡í•˜ëŠ” ì‹œìŠ¤í…œ

### 1.2 ì£¼ìš” ê¸°ëŠ¥
| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| ì‹¤ì‹œê°„ ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° | ë¦¬ì½”ë”ì—ì„œ ì„œë²„ë¡œ ì‹¤ì‹œê°„ ì˜¤ë””ì˜¤ ì „ì†¡ |
| AI ë‚™ìƒ ê°ì§€ | CNN ê¸°ë°˜ ì˜¤ë””ì˜¤ ë¶„ë¥˜ ëª¨ë¸ë¡œ ë‚™ìƒ íŒë‹¨ |
| ì‹¤ì‹œê°„ ì•Œë¦¼ | ë‚™ìƒ ê°ì§€ ì‹œ ë³´í˜¸ìì—ê²Œ ì¦‰ì‹œ í‘¸ì‹œ ì•Œë¦¼ |
| ì—°ê²° ì½”ë“œ ì‹œìŠ¤í…œ | ë³´í˜¸ì-ë¦¬ì½”ë” ê°„ ì•ˆì „í•œ ì—°ê²° |
| 119 ì‹ ê³  ì—°ë™ | ê¸´ê¸‰ ìƒí™© ì‹œ 119 ì‹ ê³  ê¸°ëŠ¥ |
| ì´ë ¥ ê´€ë¦¬ | ë‚™ìƒ ê°ì§€ ì´ë ¥ ì¡°íšŒ ë° í†µê³„ |

---

## 2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 2.1 ì „ì²´ ì•„í‚¤í…ì²˜

![ì•„í‚¤í…ì²˜ ë ˆì´ì–´](https://github.com/FAITRUEE/AudioFallcare_docs/blob/docs/architecture/%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98%20%EB%A0%88%EC%9D%B4%EC%96%B4.png?raw=true)

### 2.2 í†µì‹  íë¦„ ìš”ì•½
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  WebSocket   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   HTTP    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    FCM     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë¦¬ì½”ë”    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ FastAPI  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Spring  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ë³´í˜¸ì    â”‚
â”‚ (í”„ë¡ íŠ¸)  â”‚  ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ â”‚  (AI)    â”‚ ë‚™ìƒ ì•Œë¦¼  â”‚ (ë°±ì—”ë“œ)  â”‚  í‘¸ì‹œ ì•Œë¦¼   â”‚ (í”„ë¡ íŠ¸)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                               â–²
     â”‚              HTTP (ì½”ë“œ ê²€ì¦)                  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| êµ¬ê°„ | í”„ë¡œí† ì½œ | ìš©ë„ |
|------|----------|------|
| ë¦¬ì½”ë” â†’ Spring | HTTP | ì—°ê²° ì½”ë“œ ê²€ì¦ (ìµœì´ˆ 1íšŒ) |
| ë¦¬ì½”ë” â†’ FastAPI | WebSocket | ì‹¤ì‹œê°„ ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° |
| FastAPI â†’ Spring | HTTP | ë‚™ìƒ ê°ì§€ ì•Œë¦¼ |
| ë³´í˜¸ì â†’ Spring | HTTPS | REST API (ë¡œê·¸ì¸, ì´ë ¥ ì¡°íšŒ ë“±) |
| Spring â†’ ë³´í˜¸ì | FCM | í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡ |

### 2.3 ë°°í¬ ì•„í‚¤í…ì²˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Cloud (AWS / NCP)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Route53   â”‚â”€â”€â”€â”€â–¶â”‚              Load Balancer (ALB)                â”‚   â”‚
â”‚  â”‚   (DNS)     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚                               â”‚
â”‚                                            â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        ECS / Kubernetes                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚   Frontend    â”‚  â”‚   Backend     â”‚  â”‚   AI Server   â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   Container   â”‚  â”‚   Container   â”‚  â”‚   Container   â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   (Nginx)     â”‚  â”‚   (Spring)    â”‚  â”‚   (FastAPI)   â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   x 2         â”‚  â”‚   x 3         â”‚  â”‚   x 2         â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                            â”‚                               â”‚
â”‚                                            â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         Data Services                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚   RDS         â”‚  â”‚   ElastiCache â”‚  â”‚   S3          â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   (MySQL)     â”‚  â”‚   (Redis)     â”‚  â”‚   (Storage)   â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ê¸°ìˆ  ìŠ¤íƒ

### 3.1 Frontend
| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| React | 18.x | UI í”„ë ˆì„ì›Œí¬ |
| JavaScript | ES6+ | í´ë¼ì´ì–¸íŠ¸ ë¡œì§ |
| Vite | 5.x | ë¹Œë“œ ë„êµ¬ |
| React Router | 6.x | í´ë¼ì´ì–¸íŠ¸ ë¼ìš°íŒ… |
| Axios | 1.x | HTTP í´ë¼ì´ì–¸íŠ¸ |
| WebSocket API | - | ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° (ë¦¬ì½”ë”) |
| Firebase SDK | 10.x | FCM í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹  (ë³´í˜¸ì) |
| Web Audio API | - | ì‹¤ì‹œê°„ ì˜¤ë””ì˜¤ ì²˜ë¦¬ |
| Zustand | 4.x | ìƒíƒœ ê´€ë¦¬ |
| Tailwind CSS | 3.x | ìŠ¤íƒ€ì¼ë§ |

### 3.2 Backend
| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| Java | 17 LTS | ë°±ì—”ë“œ ì–¸ì–´ |
| Spring Boot | 3.2.x | ì›¹ í”„ë ˆì„ì›Œí¬ |
| Spring Security | 6.x | ì¸ì¦/ì¸ê°€ |
| Spring Web MVC | - | REST API |
| Spring Data JPA | - | ORM |
| JWT (jjwt) | 0.12.x | í† í° ê¸°ë°˜ ì¸ì¦ |
| Firebase Admin SDK | - | FCM í‘¸ì‹œ ì•Œë¦¼ |
| Gradle | 8.x | ë¹Œë“œ ë„êµ¬ |
| Lombok | - | ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ê°ì†Œ |
| MapStruct | - | DTO ë§¤í•‘ |

### 3.3 AI Server
| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| Python | 3.11 | AI ì„œë²„ ì–¸ì–´ |
| FastAPI | 0.109.x | API í”„ë ˆì„ì›Œí¬ |
| WebSocket (fastapi) | - | ì‹¤ì‹œê°„ ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° ìˆ˜ì‹  |
| PyTorch | 2.x | ë”¥ëŸ¬ë‹ í”„ë ˆì„ì›Œí¬ |
| torchaudio | 2.x | ì˜¤ë””ì˜¤ ë¡œë”©/ë¦¬ìƒ˜í”Œë§/Mel Spectrogram |
| librosa | 0.10.x | dB ë³€í™˜/ê³ ê¸‰ ì˜¤ë””ì˜¤ ë¶„ì„ |
| NumPy | 1.26.x | ìˆ˜ì¹˜ ì—°ì‚° |
| httpx | 0.27.x | Spring ì„œë²„ HTTP í†µì‹  |
| Uvicorn | 0.27.x | ASGI ì„œë²„ |
| Pydantic | 2.x | ë°ì´í„° ê²€ì¦ |

### 3.4 Database
| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| MySQL | 8.0 | ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤ |
| Redis | 7.0 | ìºì‹œ/ì„¸ì…˜ ì €ì¥ì†Œ |

### 3.5 Infrastructure
| ê¸°ìˆ  | ìš©ë„ |
|------|------|
| Docker | ì»¨í…Œì´ë„ˆí™” |
| Docker Compose | ë¡œì»¬ ê°œë°œ í™˜ê²½ |
| GitHub Actions | CI/CD |
| Nginx | ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ |
| AWS / NCP | í´ë¼ìš°ë“œ í˜¸ìŠ¤íŒ… |

---

## 4. API ì„¤ê³„

### 4.1 ì¸ì¦ API
| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| POST | `/api/auth/signup` | íšŒì›ê°€ì… | X |
| POST | `/api/auth/login` | ë¡œê·¸ì¸ (JWT ë°œê¸‰) | X |
| POST | `/api/auth/refresh` | í† í° ê°±ì‹  | O |
| POST | `/api/auth/logout` | ë¡œê·¸ì•„ì›ƒ | O |
| GET | `/api/auth/me` | ë‚´ ì •ë³´ ì¡°íšŒ | O |

### 4.2 ì—°ê²° ì½”ë“œ API
| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| POST | `/api/code/generate` | ì—°ê²° ì½”ë“œ ë°œê¸‰ | O |
| POST | `/api/code/verify` | ì—°ê²° ì½”ë“œ ê²€ì¦ | X |
| DELETE | `/api/code/{codeId}` | ì—°ê²° ì½”ë“œ ì‚­ì œ | O |

### 4.3 ë¦¬ì½”ë” API
| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| GET | `/api/recorders` | ì—°ê²°ëœ ë¦¬ì½”ë” ëª©ë¡ | O |
| DELETE | `/api/recorders/{id}` | ë¦¬ì½”ë” ì—°ê²° í•´ì œ | O |
| GET | `/api/recorders/{id}/status` | ë¦¬ì½”ë” ìƒíƒœ ì¡°íšŒ | O |

### 4.4 ì•Œë¦¼ API
| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| GET | `/api/alerts` | ì•Œë¦¼ ëª©ë¡ ì¡°íšŒ | O |
| PATCH | `/api/alerts/{id}/read` | ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ | O |
| GET | `/api/alerts/unread/count` | ì½ì§€ ì•Šì€ ì•Œë¦¼ ìˆ˜ | O |

### 4.5 ì´ë ¥ API
| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| GET | `/api/history` | ë‚™ìƒ ì´ë ¥ ì¡°íšŒ | O |
| GET | `/api/history/{id}` | ì´ë ¥ ìƒì„¸ ì¡°íšŒ | O |
| GET | `/api/history/stats` | í†µê³„ ì¡°íšŒ | O |

### 4.6 ì‹ ê³  API
| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| POST | `/api/report/119` | 119 ì‹ ê³  ìš”ì²­ | O |

### 4.7 FCM í‘¸ì‹œ ì•Œë¦¼
| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| POST | `/api/fcm/token` | FCM í† í° ë“±ë¡ | O |
| DELETE | `/api/fcm/token` | FCM í† í° ì‚­ì œ | O |

> FCM(Firebase Cloud Messaging)ì„ ì‚¬ìš©í•˜ì—¬ ë¸Œë¼ìš°ì €ê°€ ë‹«í˜€ìˆì–´ë„ í‘¸ì‹œ ì•Œë¦¼ì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤.
> ë³´í˜¸ìëŠ” ë¡œê·¸ì¸ ì‹œ FCM í† í°ì„ ì„œë²„ì— ë“±ë¡í•©ë‹ˆë‹¤.

#### FCM Service ìƒì„¸ ì„¤ê³„

##### í´ë˜ìŠ¤ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FCM Service Layer                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   FcmController     â”‚  â”‚   FcmService        â”‚  â”‚  FcmTokenRepository â”‚ â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚                     â”‚ â”‚
â”‚  â”‚ â€¢ POST /token       â”‚  â”‚ â€¢ registerToken()   â”‚  â”‚ â€¢ findByUserId()    â”‚ â”‚
â”‚  â”‚ â€¢ DELETE /token     â”‚  â”‚ â€¢ deleteToken()     â”‚  â”‚ â€¢ findByToken()     â”‚ â”‚
â”‚  â”‚                     â”‚  â”‚ â€¢ sendPush()        â”‚  â”‚ â€¢ save()            â”‚ â”‚
â”‚  â”‚                     â”‚  â”‚ â€¢ sendMulticast()   â”‚  â”‚ â€¢ delete()          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚            â”‚                        â”‚                        â”‚             â”‚
â”‚            â”‚                        â–¼                        â”‚             â”‚
â”‚            â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚             â”‚
â”‚            â”‚              â”‚  FirebaseMessaging  â”‚            â”‚             â”‚
â”‚            â”‚              â”‚  (Firebase Admin)   â”‚            â”‚             â”‚
â”‚            â”‚              â”‚                     â”‚            â”‚             â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ â€¢ send()            â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                           â”‚ â€¢ sendEach()        â”‚                          â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### FCM í† í° ë“±ë¡ íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Guardian â”‚              â”‚  Spring  â”‚              â”‚  MySQL   â”‚
â”‚   Web    â”‚              â”‚  Server  â”‚              â”‚    DB    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                         â”‚                         â”‚
     â”‚  1. Firebase SDK ì´ˆê¸°í™”  â”‚                         â”‚
     â”‚  (ë¡œê·¸ì¸ ì„±ê³µ í›„)        â”‚                         â”‚
     â”‚                         â”‚                         â”‚
     â”‚  2. FCM í† í° íšë“       â”‚                         â”‚
     â”‚  getToken()             â”‚                         â”‚
     â”‚                         â”‚                         â”‚
     â”‚  3. POST /api/fcm/token â”‚                         â”‚
     â”‚  {token, deviceInfo}    â”‚                         â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚
     â”‚                         â”‚                         â”‚
     â”‚                         â”‚  4. ê¸°ì¡´ í† í° ì¡°íšŒ       â”‚
     â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                         â”‚                         â”‚
     â”‚                         â”‚  5. UPSERT              â”‚
     â”‚                         â”‚  (ì¤‘ë³µ ì‹œ ê°±ì‹ )         â”‚
     â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                         â”‚                         â”‚
     â”‚  6. 201 Created         â”‚                         â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚
     â”‚                         â”‚                         â”‚
```

##### í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡ íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI  â”‚              â”‚  Spring  â”‚              â”‚   FCM    â”‚              â”‚ Guardian â”‚
â”‚   (AI)   â”‚              â”‚  Server  â”‚              â”‚ (Google) â”‚              â”‚   Web    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                         â”‚                         â”‚                         â”‚
     â”‚  1. POST /internal/fall â”‚                         â”‚                         â”‚
     â”‚  {guardianId, ...}      â”‚                         â”‚                         â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚                         â”‚
     â”‚                         â”‚                         â”‚                         â”‚
     â”‚                         â”‚  2. FCM í† í° ì¡°íšŒ       â”‚                         â”‚
     â”‚                         â”‚  (í•´ë‹¹ ì‚¬ìš©ì)          â”‚                         â”‚
     â”‚                         â”‚                         â”‚                         â”‚
     â”‚                         â”‚  3. ë©”ì‹œì§€ êµ¬ì„±         â”‚                         â”‚
     â”‚                         â”‚  {title, body, data}    â”‚                         â”‚
     â”‚                         â”‚                         â”‚                         â”‚
     â”‚                         â”‚  4. FirebaseMessaging   â”‚                         â”‚
     â”‚                         â”‚     .send()             â”‚                         â”‚
     â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚
     â”‚                         â”‚                         â”‚                         â”‚
     â”‚                         â”‚                         â”‚  5. í‘¸ì‹œ ì „ì†¡           â”‚
     â”‚                         â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                         â”‚                         â”‚                         â”‚
     â”‚  6. 200 OK              â”‚                         â”‚                         â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚                         â”‚
     â”‚                         â”‚                         â”‚                         â”‚
```

##### Firebase Admin SDK ì„¤ì •
```java
// FirebaseConfig.java
@Configuration
public class FirebaseConfig {

    @PostConstruct
    public void init() {
        try {
            FirebaseOptions options = FirebaseOptions.builder()
                .setCredentials(GoogleCredentials.fromStream(
                    new ClassPathResource("firebase-service-account.json").getInputStream()))
                .build();

            if (FirebaseApp.getApps().isEmpty()) {
                FirebaseApp.initializeApp(options);
            }
        } catch (IOException e) {
            throw new RuntimeException("Firebase ì´ˆê¸°í™” ì‹¤íŒ¨", e);
        }
    }
}
```

##### FcmService í•µì‹¬ ë©”ì„œë“œ
```java
@Service
@RequiredArgsConstructor
public class FcmService {

    private final FcmTokenRepository fcmTokenRepository;

    // í† í° ë“±ë¡/ê°±ì‹ 
    public void registerToken(Long userId, String token, String deviceInfo) {
        FcmToken fcmToken = fcmTokenRepository.findByUserIdAndToken(userId, token)
            .orElse(FcmToken.builder()
                .userId(userId)
                .token(token)
                .deviceInfo(deviceInfo)
                .build());

        fcmToken.updateTimestamp();
        fcmTokenRepository.save(fcmToken);
    }

    // ë‹¨ì¼ í‘¸ì‹œ ì „ì†¡
    public void sendPush(Long userId, String title, String body, Map<String, String> data) {
        List<FcmToken> tokens = fcmTokenRepository.findByUserId(userId);

        for (FcmToken fcmToken : tokens) {
            Message message = Message.builder()
                .setToken(fcmToken.getToken())
                .setNotification(Notification.builder()
                    .setTitle(title)
                    .setBody(body)
                    .build())
                .putAllData(data)
                .setWebpushConfig(WebpushConfig.builder()
                    .setNotification(WebpushNotification.builder()
                        .setIcon("/icons/alert-icon.png")
                        .setVibrate(new int[]{200, 100, 200})
                        .build())
                    .build())
                .build();

            try {
                FirebaseMessaging.getInstance().send(message);
            } catch (FirebaseMessagingException e) {
                // í† í° ë§Œë£Œ/ë¬´íš¨ ì‹œ ì‚­ì œ
                if (isTokenInvalid(e)) {
                    fcmTokenRepository.delete(fcmToken);
                }
            }
        }
    }

    // í† í° ìœ íš¨ì„± ê²€ì‚¬
    private boolean isTokenInvalid(FirebaseMessagingException e) {
        return e.getMessagingErrorCode() == MessagingErrorCode.UNREGISTERED
            || e.getMessagingErrorCode() == MessagingErrorCode.INVALID_ARGUMENT;
    }
}
```

##### ë©”ì‹œì§€ í˜ì´ë¡œë“œ êµ¬ì¡°
```json
{
  "notification": {
    "title": "ğŸš¨ ë‚™ìƒ ê°ì§€",
    "body": "ê±°ì‹¤ ë¦¬ì½”ë”ì—ì„œ ë‚™ìƒì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤."
  },
  "data": {
    "type": "FALL",
    "recorderId": "123",
    "recorderName": "ê±°ì‹¤",
    "confidence": "0.95",
    "detectedAt": "2026-01-28T15:30:00Z",
    "alertId": "456"
  },
  "webpush": {
    "notification": {
      "icon": "/icons/alert-icon.png",
      "vibrate": [200, 100, 200],
      "requireInteraction": true,
      "actions": [
        {"action": "view", "title": "ìƒì„¸ ë³´ê¸°"},
        {"action": "call119", "title": "119 ì‹ ê³ "}
      ]
    },
    "fcm_options": {
      "link": "/alerts/456"
    }
  }
}
```

##### í”„ë¡ íŠ¸ì—”ë“œ FCM ì„¤ì • (Service Worker)
```javascript
// firebase-messaging-sw.js
importScripts('https://www.gstatic.com/firebasejs/10.x/firebase-app-compat.js');
importScripts('https://www.gstatic.com/firebasejs/10.x/firebase-messaging-compat.js');

firebase.initializeApp({
  apiKey: "...",
  projectId: "audiofallcare",
  messagingSenderId: "...",
  appId: "..."
});

const messaging = firebase.messaging();

// ë°±ê·¸ë¼ìš´ë“œ ë©”ì‹œì§€ ì²˜ë¦¬
messaging.onBackgroundMessage((payload) => {
  const { title, body } = payload.notification;
  const options = {
    body,
    icon: '/icons/alert-icon.png',
    badge: '/icons/badge.png',
    vibrate: [200, 100, 200],
    data: payload.data,
    actions: [
      { action: 'view', title: 'ìƒì„¸ ë³´ê¸°' },
      { action: 'call119', title: '119 ì‹ ê³ ' }
    ],
    requireInteraction: true
  };

  self.registration.showNotification(title, options);
});

// ì•Œë¦¼ í´ë¦­ ì²˜ë¦¬
self.addEventListener('notificationclick', (event) => {
  event.notification.close();

  if (event.action === 'call119') {
    clients.openWindow('/report/119?alertId=' + event.notification.data.alertId);
  } else {
    clients.openWindow('/alerts/' + event.notification.data.alertId);
  }
});
```

##### í† í° ê°±ì‹  ì²˜ë¦¬ (í”„ë¡ íŠ¸ì—”ë“œ)
```javascript
// useFcm.js
import { getToken, onMessage } from 'firebase/messaging';

export const useFcm = () => {
  const registerFcmToken = async () => {
    const permission = await Notification.requestPermission();
    if (permission !== 'granted') return;

    const token = await getToken(messaging, {
      vapidKey: process.env.VITE_FIREBASE_VAPID_KEY
    });

    // ì„œë²„ì— í† í° ë“±ë¡
    await api.post('/api/fcm/token', {
      token,
      deviceInfo: navigator.userAgent
    });
  };

  // í¬ê·¸ë¼ìš´ë“œ ë©”ì‹œì§€ ìˆ˜ì‹ 
  onMessage(messaging, (payload) => {
    // ì•± ë‚´ ì•Œë¦¼ í‘œì‹œ (í† ìŠ¤íŠ¸ ë“±)
    showToast(payload.notification);
  });

  return { registerFcmToken };
};
```

### 4.8 AI Server API

#### HTTP API
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| POST | `/ai/alert` | ë‚™ìƒ ê°ì§€ ê²°ê³¼ Springìœ¼ë¡œ ì „ì†¡ |
| GET | `/ai/health` | ì„œë²„ ìƒíƒœ í™•ì¸ |
| GET | `/ai/model/info` | ëª¨ë¸ ì •ë³´ ì¡°íšŒ |

#### WebSocket API
| Endpoint | ì„¤ëª… | ì¸ì¦ |
|----------|------|------|
| `WS /ws/audio/stream` | ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° (ë¦¬ì½”ë”â†’AI) | ì½”ë“œ ê¸°ë°˜ |

> ë¦¬ì½”ë”ëŠ” ì—°ê²° ì½”ë“œì™€ guardianIdë¥¼ í¬í•¨í•˜ì—¬ WebSocket ì—°ê²°ì„ ìˆ˜ë¦½í•©ë‹ˆë‹¤.

---

## 5. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 5.1 ERD
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     users       â”‚       â”‚    recorders    â”‚       â”‚  connect_codes  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚â”€â”€â”    â”‚ id (PK)         â”‚       â”‚ id (PK)         â”‚
â”‚ email           â”‚  â”‚    â”‚ user_id (FK)    â”‚â”€â”€â”    â”‚ user_id (FK)    â”‚â”€â”€â”
â”‚ password        â”‚  â”‚    â”‚ name            â”‚  â”‚    â”‚ code            â”‚  â”‚
â”‚ name            â”‚  â”‚    â”‚ status          â”‚  â”‚    â”‚ expires_at      â”‚  â”‚
â”‚ phone           â”‚  â”‚    â”‚ last_active_at  â”‚  â”‚    â”‚ used            â”‚  â”‚
â”‚ created_at      â”‚  â”‚    â”‚ created_at      â”‚  â”‚    â”‚ created_at      â”‚  â”‚
â”‚ updated_at      â”‚  â”‚    â”‚ updated_at      â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚           â”‚
         â”‚           â”‚             â”‚                         â”‚           â”‚
         â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
         â”‚                         â”‚                                     â”‚
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
         â”‚    â”‚                                                          â”‚
         â–¼    â–¼                                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     alerts      â”‚       â”‚  fall_history   â”‚       â”‚   fcm_tokens    â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ id (PK)         â”‚       â”‚ id (PK)         â”‚       â”‚ id (PK)         â”‚ â”‚
â”‚ user_id (FK)    â”‚â—€â”€â”€â”€â”€â”€â”€â”‚ user_id (FK)    â”‚â—€â”€â”€â”€â”€â”€â”€â”‚ user_id (FK)    â”‚â—€â”˜
â”‚ recorder_id(FK) â”‚       â”‚ recorder_id(FK) â”‚       â”‚ token           â”‚
â”‚ type            â”‚       â”‚ confidence      â”‚       â”‚ device_info     â”‚
â”‚ message         â”‚       â”‚ sound_type      â”‚       â”‚ created_at      â”‚
â”‚ is_read         â”‚       â”‚ audio_url       â”‚       â”‚ updated_at      â”‚
â”‚ created_at      â”‚       â”‚ detected_at     â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ created_at      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 í…Œì´ë¸” ëª…ì„¸

#### users (ì‚¬ìš©ì)
| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|------|------|----------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ì‚¬ìš©ì ID |
| email | VARCHAR(255) | UNIQUE, NOT NULL | ì´ë©”ì¼ |
| password | VARCHAR(255) | NOT NULL | ë¹„ë°€ë²ˆí˜¸ (BCrypt) |
| name | VARCHAR(100) | NOT NULL | ì´ë¦„ |
| phone | VARCHAR(20) | NOT NULL | ì „í™”ë²ˆí˜¸ |
| created_at | DATETIME | NOT NULL | ìƒì„±ì¼ì‹œ |
| updated_at | DATETIME | NOT NULL | ìˆ˜ì •ì¼ì‹œ |

#### recorders (ë¦¬ì½”ë”)
| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|------|------|----------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ë¦¬ì½”ë” ID |
| user_id | BIGINT | FK, NOT NULL | ë³´í˜¸ì ID |
| name | VARCHAR(100) | NOT NULL | ë¦¬ì½”ë” ì´ë¦„ |
| status | ENUM | NOT NULL | CONNECTED, DISCONNECTED |
| last_active_at | DATETIME | NULL | ë§ˆì§€ë§‰ í™œì„± ì‹œê°„ |
| created_at | DATETIME | NOT NULL | ìƒì„±ì¼ì‹œ |
| updated_at | DATETIME | NOT NULL | ìˆ˜ì •ì¼ì‹œ |

#### connect_codes (ì—°ê²° ì½”ë“œ)
| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|------|------|----------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ì½”ë“œ ID |
| user_id | BIGINT | FK, NOT NULL | ë³´í˜¸ì ID |
| code | VARCHAR(10) | UNIQUE, NOT NULL | ì—°ê²° ì½”ë“œ |
| expires_at | DATETIME | NOT NULL | ë§Œë£Œì¼ì‹œ |
| used | BOOLEAN | DEFAULT FALSE | ì‚¬ìš© ì—¬ë¶€ |
| created_at | DATETIME | NOT NULL | ìƒì„±ì¼ì‹œ |

#### alerts (ì•Œë¦¼)
| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|------|------|----------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ì•Œë¦¼ ID |
| user_id | BIGINT | FK, NOT NULL | ë³´í˜¸ì ID |
| recorder_id | BIGINT | FK, NOT NULL | ë¦¬ì½”ë” ID |
| type | ENUM | NOT NULL | FALL, WARNING, INFO |
| message | VARCHAR(500) | NOT NULL | ì•Œë¦¼ ë©”ì‹œì§€ |
| is_read | BOOLEAN | DEFAULT FALSE | ì½ìŒ ì—¬ë¶€ |
| created_at | DATETIME | NOT NULL | ìƒì„±ì¼ì‹œ |

#### fall_history (ë‚™ìƒ ì´ë ¥)
| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|------|------|----------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ì´ë ¥ ID |
| user_id | BIGINT | FK, NOT NULL | ë³´í˜¸ì ID |
| recorder_id | BIGINT | FK, NOT NULL | ë¦¬ì½”ë” ID |
| confidence | FLOAT | NOT NULL | ì‹ ë¢°ë„ (0~1) |
| sound_type | VARCHAR(50) | NOT NULL | ì†Œë¦¬ ìœ í˜• |
| audio_url | VARCHAR(500) | NULL | ì˜¤ë””ì˜¤ íŒŒì¼ URL |
| detected_at | DATETIME | NOT NULL | ê°ì§€ ì‹œê°„ |
| created_at | DATETIME | NOT NULL | ìƒì„±ì¼ì‹œ |

#### fcm_tokens (FCM í† í°)
| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ì¡°ê±´ | ì„¤ëª… |
|------|------|----------|------|
| id | BIGINT | PK, AUTO_INCREMENT | í† í° ID |
| user_id | BIGINT | FK, NOT NULL | ë³´í˜¸ì ID |
| token | VARCHAR(500) | NOT NULL | FCM í† í° |
| device_info | VARCHAR(255) | NULL | ê¸°ê¸° ì •ë³´ |
| created_at | DATETIME | NOT NULL | ìƒì„±ì¼ì‹œ |
| updated_at | DATETIME | NOT NULL | ìˆ˜ì •ì¼ì‹œ |

---

## 6. ë³´ì•ˆ ì„¤ê³„

### 6.1 ì¸ì¦/ì¸ê°€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        JWT ì¸ì¦ íë¦„                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ë¡œê·¸ì¸ ìš”ì²­
   Client â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Server
           POST /api/auth/login
           { email, password }

2. JWT í† í° ë°œê¸‰
   Client â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Server
           {
             accessToken: "eyJhbG...",    (ìœ íš¨ê¸°ê°„: 30ë¶„)
             refreshToken: "eyJhbG..."    (ìœ íš¨ê¸°ê°„: 7ì¼)
           }

3. API ìš”ì²­ (ì¸ì¦ í•„ìš”)
   Client â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Server
           GET /api/alerts
           Authorization: Bearer eyJhbG...

4. í† í° ë§Œë£Œ ì‹œ ê°±ì‹ 
   Client â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Server
           POST /api/auth/refresh
           { refreshToken: "eyJhbG..." }
```

### 6.2 ë³´ì•ˆ ì •ì±…
| í•­ëª© | ì •ì±… |
|------|------|
| ë¹„ë°€ë²ˆí˜¸ | BCrypt í•´ì‹œ (ê°•ë„ 12) |
| Access Token | ìœ íš¨ê¸°ê°„ 30ë¶„ |
| Refresh Token | ìœ íš¨ê¸°ê°„ 7ì¼, Redis ì €ì¥ |
| HTTPS | TLS 1.3 í•„ìˆ˜ |
| CORS | í—ˆìš© ë„ë©”ì¸ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ |
| Rate Limiting | 100 req/min per IP |
| SQL Injection | JPA Parameterized Query |
| XSS | React ìë™ ì´ìŠ¤ì¼€ì´í”„ |

### 6.3 ì—°ê²° ì½”ë“œ ë³´ì•ˆ
- 6ìë¦¬ ì˜ìˆ«ì ì¡°í•© (ëŒ€ë¬¸ì + ìˆ«ì)
- ìœ íš¨ê¸°ê°„: 24ì‹œê°„
- 1íšŒ ì‚¬ìš© í›„ ë§Œë£Œ
- ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì§€: 5íšŒ ì‹¤íŒ¨ ì‹œ 10ë¶„ ì ê¸ˆ

---

## 7. AI ëª¨ë¸ ì„¤ê³„

### 7.1 ëª¨ë¸ ì•„í‚¤í…ì²˜
```
Input: Mel Spectrogram (1, 64, 94)
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Conv2d(1, 32, 3x3)      â”‚
â”‚ BatchNorm2d + ReLU      â”‚
â”‚ MaxPool2d(2x2)          â”‚
â”‚ Dropout(0.2)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Conv2d(32, 64, 3x3)     â”‚
â”‚ BatchNorm2d + ReLU      â”‚
â”‚ MaxPool2d(2x2)          â”‚
â”‚ Dropout(0.2)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Conv2d(64, 128, 3x3)    â”‚
â”‚ BatchNorm2d + ReLU      â”‚
â”‚ MaxPool2d(2x2)          â”‚
â”‚ Dropout(0.3)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Conv2d(128, 256, 3x3)   â”‚
â”‚ BatchNorm2d + ReLU      â”‚
â”‚ AdaptiveAvgPool2d(1,1)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flatten                 â”‚
â”‚ Linear(256, 128)        â”‚
â”‚ ReLU + Dropout(0.5)     â”‚
â”‚ Linear(128, 1)          â”‚
â”‚ Sigmoid                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–¼
Output: ë‚™ìƒ í™•ë¥  (0~1)
```

### 7.2 ì˜¤ë””ì˜¤ ì „ì²˜ë¦¬
| ë‹¨ê³„ | ì„¤ëª… | íŒŒë¼ë¯¸í„° | ë¼ì´ë¸ŒëŸ¬ë¦¬ |
|------|------|----------|------------|
| 1. ë¡œë“œ | ì˜¤ë””ì˜¤ íŒŒì¼ ë¡œë“œ | - | torchaudio |
| 2. ë¦¬ìƒ˜í”Œë§ | 16kHzë¡œ ë³€í™˜ | sample_rate=16000 | torchaudio.transforms.Resample |
| 3. ëª¨ë…¸ ë³€í™˜ | ìŠ¤í…Œë ˆì˜¤â†’ëª¨ë…¸ | mono=True | torchaudio |
| 4. ê¸¸ì´ ì¡°ì • | 3ì´ˆë¡œ íŒ¨ë”©/ìë¥´ê¸° | max_length=3s | torch |
| 5. Mel Spectrogram | ì‹œê°„-ì£¼íŒŒìˆ˜ ë³€í™˜ | n_mels=64, n_fft=1024 | torchaudio.transforms.MelSpectrogram |
| 6. dB ë³€í™˜ | Power to dB | ref=np.max | librosa.power_to_db |
| 7. ì •ê·œí™” | í‰ê·  0, í‘œì¤€í¸ì°¨ 1 | - | torch |

> **torchaudio + librosa í˜¼í•© ì‚¬ìš© ì´ìœ **
> - **torchaudio**: GPU ê°€ì† ì§€ì›, PyTorch í…ì„œì™€ ì§ì ‘ ì—°ë™, ì‹¤ì‹œê°„ ì²˜ë¦¬ì— ìµœì í™”
> - **librosa**: dB ë³€í™˜ ë“± ì¼ë¶€ ê³ ê¸‰ ê¸°ëŠ¥ì—ì„œ ì•ˆì •ì ì¸ ê²°ê³¼ ì œê³µ

### 7.3 ëª¨ë¸ ì„±ëŠ¥
| ë©”íŠ¸ë¦­ | ê°’ |
|--------|-----|
| F1 Score | 96.55% |
| Accuracy | 96.84% |
| Precision | 96.55% |
| Recall | 96.55% |
| í•™ìŠµ ë°ì´í„° | SAFE Dataset (950 samples) |

---

## 8. ì‹¤ì‹œê°„ ì²˜ë¦¬ íë¦„

### 8.1 ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Recorderâ”‚    â”‚   AI    â”‚    â”‚ Backend â”‚    â”‚Guardian â”‚
â”‚ Client  â”‚    â”‚ Server  â”‚    â”‚ Server  â”‚    â”‚  App    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚              â”‚              â”‚              â”‚
     â”‚  1. ì½”ë“œ ê²€ì¦ (HTTP)        â”‚              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚
     â”‚  {guardianId: 123}          â”‚              â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
     â”‚              â”‚              â”‚              â”‚
     â”‚  2. WebSocketâ”‚              â”‚              â”‚
     â”‚     Connect  â”‚              â”‚              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚              â”‚
     â”‚  (code, guardianId í¬í•¨)    â”‚              â”‚
     â”‚              â”‚              â”‚              â”‚
     â”‚  3. Audio    â”‚              â”‚              â”‚
     â”‚  Chunk (3s)  â”‚              â”‚              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚              â”‚
     â”‚              â”‚              â”‚              â”‚
     â”‚              â”‚ [AI ë¶„ì„]    â”‚              â”‚
     â”‚              â”‚              â”‚              â”‚
     â”‚              â”‚ 4. ë‚™ìƒ ê°ì§€ ì‹œ              â”‚
     â”‚              â”‚    POST /api/internal/fall  â”‚
     â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚
     â”‚              â”‚              â”‚              â”‚
     â”‚              â”‚              â”‚ 5. FCM Push  â”‚
     â”‚              â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚              â”‚              â”‚ "ë‚™ìƒ ê°ì§€"  â”‚
     â”‚              â”‚              â”‚              â”‚
```

**íë¦„ ì„¤ëª…:**
1. ë¦¬ì½”ë”ê°€ Springì— ì—°ê²° ì½”ë“œ ê²€ì¦ ìš”ì²­ (HTTP)
2. ë¦¬ì½”ë”ê°€ FastAPIì— WebSocket ì—°ê²° (ì½”ë“œ, guardianId í¬í•¨)
3. ë¦¬ì½”ë”ê°€ 3ì´ˆ ë‹¨ìœ„ ì˜¤ë””ì˜¤ ì²­í¬ ì „ì†¡
4. AIê°€ ë‚™ìƒ ê°ì§€ ì‹œ Springì— HTTPë¡œ ì•Œë¦¼
5. Springì´ ë³´í˜¸ìì—ê²Œ FCM í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡

### 8.2 ì•Œë¦¼ ìš°ì„ ìˆœìœ„
| ìš°ì„ ìˆœìœ„ | ì‹ ë¢°ë„ | ì•Œë¦¼ ë°©ì‹ |
|----------|--------|-----------|
| ê¸´ê¸‰ | 90% ì´ìƒ | í‘¸ì‹œ + ì†Œë¦¬ + ì§„ë™ |
| ê²½ê³  | 70~90% | í‘¸ì‹œ + ì§„ë™ |
| ì£¼ì˜ | 50~70% | í‘¸ì‹œë§Œ |

---

## 9. ì—ëŸ¬ ì²˜ë¦¬

### 9.1 ì—ëŸ¬ ì‘ë‹µ í˜•ì‹
```json
{
  "success": false,
  "error": {
    "code": "AUTH_001",
    "message": "ì¸ì¦ í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",
    "timestamp": "2025-01-28T12:00:00Z"
  }
}
```

### 9.2 ì—ëŸ¬ ì½”ë“œ
| ì½”ë“œ | HTTP Status | ì„¤ëª… |
|------|-------------|------|
| AUTH_001 | 401 | í† í° ë§Œë£Œ |
| AUTH_002 | 401 | ìœ íš¨í•˜ì§€ ì•Šì€ í† í° |
| AUTH_003 | 403 | ê¶Œí•œ ì—†ìŒ |
| CODE_001 | 400 | ì˜ëª»ëœ ì—°ê²° ì½”ë“œ |
| CODE_002 | 400 | ë§Œë£Œëœ ì—°ê²° ì½”ë“œ |
| AI_001 | 503 | AI ì„œë²„ ì—°ê²° ì‹¤íŒ¨ |
| AI_002 | 500 | ëª¨ë¸ ì¶”ë¡  ì‹¤íŒ¨ |

---

## 10. ëª¨ë‹ˆí„°ë§

### 10.1 ë¡œê¹…
| ë ˆë²¨ | ìš©ë„ |
|------|------|
| ERROR | ì‹œìŠ¤í…œ ì˜¤ë¥˜, AI ì¶”ë¡  ì‹¤íŒ¨ |
| WARN | ì¸ì¦ ì‹¤íŒ¨, ì—°ê²° ì½”ë“œ ì˜¤ë¥˜ |
| INFO | API ìš”ì²­, ë‚™ìƒ ê°ì§€ |
| DEBUG | ìƒì„¸ ì²˜ë¦¬ ê³¼ì • |

### 10.2 ë©”íŠ¸ë¦­
| ë©”íŠ¸ë¦­ | ì„¤ëª… |
|--------|------|
| api_request_total | API ìš”ì²­ ìˆ˜ |
| api_request_duration | API ì‘ë‹µ ì‹œê°„ |
| websocket_connections | WebSocket ì—°ê²° ìˆ˜ |
| ai_inference_duration | AI ì¶”ë¡  ì‹œê°„ |
| fall_detection_total | ë‚™ìƒ ê°ì§€ íšŸìˆ˜ |

### 10.3 ì•Œë¦¼
| ì¡°ê±´ | ì•Œë¦¼ |
|------|------|
| API ì‘ë‹µì‹œê°„ > 3s | Slack ì•Œë¦¼ |
| AI ì„œë²„ ë‹¤ìš´ | ê¸´ê¸‰ ì•Œë¦¼ |
| ì—ëŸ¬ìœ¨ > 5% | Slack ì•Œë¦¼ |

---

## 11. ë²„ì „ ê´€ë¦¬

### 11.1 API ë²„ì „
- URL ê²½ë¡œ ë°©ì‹: `/api/v1/...`
- í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€ ì›ì¹™

### 11.2 ëª¨ë¸ ë²„ì „
- ì‹œë§¨í‹± ë²„ì „: `v1.0.0`
- ëª¨ë¸ íŒŒì¼ëª…: `model_v1.0.0.pt`
- ë¡¤ë°± ê°€ëŠ¥í•œ êµ¬ì¡°

---

## 12. í–¥í›„ í™•ì¥ ê³„íš

| ë‹¨ê³„ | ë‚´ìš© |
|------|------|
| Phase 1 | í˜„ì¬ êµ¬í˜„ (ë‚™ìƒ/ë¹„ë‚™ìƒ 2ë¶„ë¥˜) |
| Phase 2 | ë‹¤ì¤‘ ë¶„ë¥˜ (ë‚™ìƒ, ë¹„ëª…, ë„ì›€ìš”ì²­, ì¼ë°˜) |
| Phase 3 | ìŒì„± ì¸ì‹ ì—°ë™ ("ë„ì™€ì£¼ì„¸ìš”" ê°ì§€) |

---

*ë¬¸ì„œ ë²„ì „: 1.14*
*ìµœì¢… ìˆ˜ì •: 2026-01-29*
